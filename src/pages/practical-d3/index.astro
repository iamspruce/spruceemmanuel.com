---
import D3SiteLayout from "@layouts/D3jsLayout.astro";
import { getCourseStructure } from "@utils/courseUtils";
import ElectronRing from "@components/ElectronRing.astro";

const myRings = [
  {
    rotation: 0,
    color: "var(--pink-10)",
    speed: 0.5,
    electrons: [
      { angle: 0, link: "/page-1", label: "Go to Page 1" },
      { angle: 180, link: "/page-2", label: "Go to Page 2" },
    ],
  },
  {
    rotation: 60,
    color: "var(--amber-8)",
    speed: -0.8,
    electrons: [{ angle: 90, link: "/page-3", label: "Go to Page 3" }],
  },
  {
    rotation: 120,
    color: "var(--green-8)",
    speed: 0.6,
    electrons: [
      { angle: 45, link: "/page-4", label: "Go to Page 4" },
      { angle: 135, link: "/page-5", label: "Go to Page 5" },
      { angle: 225, link: "/page-6", label: "Go to Page 6" },
      { angle: 315, link: "/page-7", label: "Go to Page 7" },
    ],
  },
];

const courseStructure = await getCourseStructure();
---

<D3SiteLayout
  title="D3.js Course"
  description="Learn D3.js from the ground up with interactive lessons and quizzes"
  chapterSlug=""
  lessonSlug=""
  hasQuiz={false}
>
  <div class="page-glow"></div>
  <section>
    <header>
      <hgroup>
        <h1>learn D3.js Practically</h1>
        <h2>A Practical hands on course to learn D3</h2>
      </hgroup>
    </header>
    <nav class="central-featured" aria-label="D3.js Course Topics">
      <ul>
        <li>
          <a href="#intro" title="Introduction to D3.js">
            <strong>Introduction</strong>
            <small>Get started</small>
          </a>
        </li>
        <li>
          <a href="#bar-chart" title="Bar Chart">
            <strong>Bar Chart</strong>
            <small>Scales & axes</small>
          </a>
        </li>
        <li>
          <a href="#line-chart" title="Line Chart">
            <strong>Line Chart</strong>
            <small>Trends & paths</small>
          </a>
        </li>
        <li>
          <a href="#pie-chart" title="Pie Chart">
            <strong>Pie Chart</strong>
            <small>Arcs & colors</small>
          </a>
        </li>
        <li>
          <a href="#scatterplot" title="Scatterplot">
            <strong>Scatterplot</strong>
            <small>Dots & data</small>
          </a>
        </li>
        <li>
          <a href="#bubble-chart" title="Bubble Chart">
            <strong>Bubble Chart</strong>
            <small>Size & color</small>
          </a>
        </li>
        <li>
          <a href="#hierarchical" title="Hierarchical Charts">
            <strong>Hierarchical</strong>
            <small>Tree & sunburst</small>
          </a>
        </li>
        <li>
          <a href="#geo" title="Geographical Maps">
            <strong>Geo Maps</strong>
            <small>World data</small>
          </a>
        </li>
        <li>
          <a href="#animation" title="Animation & Interaction">
            <strong>Animation</strong>
            <small>Motion & events</small>
          </a>
        </li>
        <li>
          <a href="#dashboard" title="Interactive Dashboard">
            <strong>Dashboard</strong>
            <small>All in one</small>
          </a>
        </li>
      </ul>
      <ElectronRing text="D3.js" rings={myRings} />
    </nav>

    <div class="outline-wrapper">
      <button class="toggle-btn" id="toggleOutline" aria-expanded="false">
        <span class="btn-text">View Course Outline</span>
        <span class="icon-wrapper">
          <svg
            viewBox="0 0 24 24"
            class="icon-arrow"
            width="20"
            height="20"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </span>
      </button>

      <div class="outline-content" id="outlineContent">
        <div class="outline-inner">
          <div class="outline-grid">
            {
              courseStructure.map((chapter, index) => (
                <article class="chapter-card">
                  <header class="chapter-header">
                    <span class="chapter-number">
                      {(index + 1).toString().padStart(2, "0")}
                    </span>
                    <h3>{chapter.title}</h3>
                  </header>
                  <ul class="lesson-list">
                    {chapter.lessons.map((lesson) => (
                      <li>
                        <a href={lesson.href}>
                          <span class="icon-dot" />
                          {lesson.title}
                        </a>
                      </li>
                    ))}
                  </ul>
                </article>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </section>
</D3SiteLayout>

<style>
  :global(section) {
    padding: var(--space-2xs) var(--space-3xs);
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-3xs);
    align-items: center;
  }

  header {
    text-align: center;
    margin-block: var(--space-s);
  }

  hgroup h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  hgroup h2 {
    font-size: 1.5rem;
    color: var(--mauve-11);
  }

  .central-featured {
    position: relative;
    height: 325px;
    max-width: 546px;
    width: 100%;
    margin: 0 auto;
    text-align: center;
  }

  @media (min-width: 800px) {
    .central-featured {
      height: 345px;
      max-width: 566px;
    }
  }
  @media (min-width: 1024px) {
    .central-featured {
      height: 385px;
      max-width: 644px;
    }
  }
  .central-featured > :global(.electron-container) {
    position: absolute;
    top: 50%;
    left: 50%;
    z-index: 1;
    transform: translate(-50%, -50%);
  }

  .central-featured ul {
    position: relative;
    list-style: none;
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    display: block;
  }

  .central-featured li {
    position: absolute;
  }

  .central-featured li:nth-child(1) {
    top: 0%;
    right: 60%;
  }
  .central-featured li:nth-child(2) {
    top: 0%;
    left: 60%;
  }
  .central-featured li:nth-child(3) {
    top: 20%;
    left: 70%;
  }
  .central-featured li:nth-child(4) {
    top: 20%;
    right: 70%;
  }
  .central-featured li:nth-child(5) {
    top: 40%;
    right: 72%;
  }
  .central-featured li:nth-child(6) {
    top: 40%;
    left: 72%;
  }
  .central-featured li:nth-child(7) {
    top: 60%;
    right: 70%;
  }
  .central-featured li:nth-child(8) {
    top: 60%;
    left: 70%;
  }
  .central-featured li:nth-child(9) {
    top: 80%;
    right: 60%;
  }
  .central-featured li:nth-child(10) {
    top: 80%;
    left: 60%;
  }

  .central-featured strong {
    display: block;
    font-size: 16px;
    font-weight: 600;
    text-decoration: none;
  }

  .central-featured small {
    display: block;
    font-size: 14px;
    color: var(--mauve-11);
  }

  /* Local Design System for Outline */
  .outline-wrapper {
    --surface-1: var(--mauve-1);
    --surface-2: var(--mauve-3);
    --surface-3: var(--mauve-4);
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md:
      0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg:
      0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --radius-m: 12px;
    --radius-s: 8px;
  }

  /* Outline wrapper */
  .outline-wrapper {
    width: 100%;
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }

  /* Modern Toggle button */
  .toggle-btn {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-2xs) var(--space-xs);
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--mauve-12);
    background: var(--surface-2);
    border: 1px solid var(--mauve-6);
    border-radius: var(--radius-s);
    cursor: pointer;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    z-index: 10;
  }

  .toggle-btn:hover {
    background: var(--surface-3);
    border-color: var(--mauve-8);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
  }

  .toggle-btn:active {
    transform: translateY(0);
  }

  .icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.4s ease;
  }

  .toggle-btn[aria-expanded="true"] .icon-wrapper {
    transform: rotate(180deg);
  }

  .toggle-btn[aria-expanded="true"] {
    background: var(--mauve-12);
    color: var(--mauve-1);
    border-color: transparent;
  }

  .icon-arrow {
    width: 20px;
    height: 20px;
  }

  /* Smooth Expansion Content */
  .outline-content {
    width: 100%;
    display: grid;
    grid-template-rows: 0fr;
    transition:
      grid-template-rows 0.5s cubic-bezier(0.4, 0, 0.2, 1),
      opacity 0.5s ease;
    opacity: 0;
  }

  .toggle-btn[aria-expanded="true"] ~ .outline-content {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  .outline-inner {
    overflow: hidden;
  }

  /* Grid Layout for Chapters */
  .outline-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-m);
    padding: var(--space-xs);
    width: 100%;
  }

  /* Chapter Card */
  .chapter-card {
    background: var(--surface-1);
    border: 1px solid var(--mauve-6);
    border-radius: var(--radius-s);
    padding: var(--space-2xs);
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease,
      border-color 0.3s ease;
    display: flex;
    flex-direction: column;
    gap: var(--space-s);
  }

  .chapter-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--pink-8);
  }

  .chapter-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-s);
    padding: var(--space-xs);
    border-bottom: 2px solid var(--mauve-4);
  }

  .chapter-number {
    font-family: var(--font-mono);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--mauve-4);
    letter-spacing: -1px;
    line-height: 1;
  }

  .chapter-card:hover .chapter-number {
    color: var(--pink-9);
  }

  .chapter-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--mauve-12);
    line-height: 1.3;
  }

  /* Lessons List */
  .lesson-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-2xs);
  }

  .lesson-list li {
    width: 100%;
  }

  .lesson-list a {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-s);
    color: var(--mauve-10);
    text-decoration: none;
    border-radius: var(--radius-s);
    font-size: 0.95rem;
    transition: all 0.2s ease;
  }

  .icon-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: var(--mauve-6);
    transition: background-color 0.2s ease;
  }

  .lesson-list a:hover {
    color: var(--mauve-12);
    background-color: var(--mauve-3);
  }

  .lesson-list a:hover .icon-dot {
    background-color: var(--pink-9);
    box-shadow: 0 0 8px var(--pink-9);
  }

  @media (max-width: 600px) {
    .outline-grid {
      grid-template-columns: 1fr;
    }

    .chapter-card {
      padding: var(--space-s);
    }
  }
</style>

<script>
  const btn = document.getElementById("toggleOutline");

  btn?.addEventListener("click", () => {
    const isExpanded = btn.getAttribute("aria-expanded") === "true";
    btn.setAttribute("aria-expanded", String(!isExpanded));
  });
</script>
